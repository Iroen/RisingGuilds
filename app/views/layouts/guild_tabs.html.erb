<% content_for :guild_header do %>
<% 
@guild ||= Guild.find(params[:guild_id]) 
@online_characters ||= @guild.characters.find_all_by_online(true) unless @guild.nil?
%>
<div class="guildlogo">
	<%= image_tag(@guild.logo.url, :alt => "guildlogo", :size => "100x100") %>
</div>
<div class="guildname">
  <%=h @guild.name %>
</div>
<div id="guildmembers">
  <%=h @guild.characters.count %> members <%=h "(#{@online_characters.count} online)"%>
</div>
<div id="guildrealm">
  <%=h @guild.realm %>	
</div>
<% unless @guild.website.nil? %>
<div id="website">
  <%= link_to @guild.website, @guild.website, :popup => true %>
</div>
<% end %>
<% end %>

<% content_for :tabs do %>
<%
@tabs << link_to("Guild", guild_path(@guild))
@tabs << link_to("Members", guild_characters_path(@guild))
if @guild.users.include?(current_user)
	@tabs << link_to("Raids", guild_raids_path(@guild)) 
	@tabs << link_to("Users", guild_users_path(@guild)) 
end

if permitted_to? :edit, @guild
	@tabs << ""
	@tabs << link_to("Edit", edit_guild_path(@guild))
	@tabs << link_to("Actualize", :action => "actualize", :id => @guild.id)
end

render :partial => 'shared/tabs', :locals => {:tabs => @tabs}
%>
<% end %>

<% content_for :content do %>
  <%= yield %>
<% end %>

<%= render(:file => 'layouts/application')%>

